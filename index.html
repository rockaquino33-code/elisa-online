<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ELISA Ultra — Single File</title>
<style>
/* ---------- RESET & BASE ---------- */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);
  color:#fff; -webkit-font-smoothing:antialiased;
  display:flex;flex-direction:column;min-height:100vh;overflow:hidden;
}

/* ---------- HEADER ---------- */
header{
  display:flex;justify-content:space-between;align-items:center;
  padding:12px 18px;background:rgba(0,0,0,0.5);border-bottom:1px solid rgba(255,255,255,0.06);
  backdrop-filter: blur(6px);
}
.header-left{display:flex;align-items:center;gap:12px}
.logo{
  width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#1f6feb,#7b61ff);
  display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;font-size:18px;box-shadow:0 6px 18px rgba(0,0,0,.4)
}
.header-title{font-weight:700;font-size:16px}
.header-right{display:flex;align-items:center;gap:8px}

/* ---------- LOGIN / DESKTOP ---------- */
#login-screen, #desktop {
  flex:1; display:flex; align-items:center; justify-content:center; padding:18px;
}
.login-box{
  width:360px; background:rgba(0,0,0,0.6); padding:18px;border-radius:12px;
  border:1px solid rgba(255,255,255,0.06); box-shadow:0 12px 30px rgba(0,0,0,0.6);
}
.login-box h2{margin-bottom:12px}
.login-box input{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:#fff}
.login-box button{width:100%;padding:10px;margin-top:12px;border-radius:8px;border:none;background:#7b61ff;color:#fff;font-weight:700;cursor:pointer}

/* ---------- DESKTOP LAYOUT ---------- */
.desktop-inner{width:100%;max-width:1200px;margin:0 auto;display:flex;flex-direction:column;align-items:center}
.menu{display:flex;flex-wrap:wrap;gap:14px;justify-content:center;margin-top:12px}
.app-btn{
  width:100px;height:100px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.06);
  border-radius:14px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;cursor:pointer;
  transition:transform .12s ease, background .12s ease; color:#fff;
}
.app-btn:hover{transform:translateY(-6px);background:rgba(255,255,255,0.95);color:#111}
.app-btn svg{width:36px;height:36px;display:block;}

/* ---------- WINDOWS AREA ---------- */
.windows-area{
  width:95%;max-width:1200px;height:56vh;margin-top:18px;background:rgba(0,0,0,0.18);
  border-radius:12px;border:1px solid rgba(255,255,255,0.04);position:relative;overflow:hidden;padding:8px;
}

/* ---------- WINDOW ---------- */
.win{
  position:absolute; top:20px; left:20px; width:360px; min-height:220px;
  background:linear-gradient(180deg,rgba(0,0,0,0.92),rgba(0,0,0,0.86));
  border-radius:12px;border:1px solid rgba(255,255,255,0.06);box-shadow:0 18px 50px rgba(0,0,0,0.7);
  display:flex;flex-direction:column;overflow:hidden;animation:pop .14s ease;
}
@keyframes pop{from{transform:scale(.96);opacity:0}to{transform:scale(1);opacity:1}}
.win .head{
  padding:10px 12px;background:rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:center;cursor:grab;
  border-bottom:1px solid rgba(255,255,255,0.03)
}
.win .head .title{font-weight:700}
.win .head .controls{display:flex;gap:8px}
.ctrl-btn{width:30px;height:28px;border-radius:6px;border:none;background:transparent;color:#fff;cursor:pointer;font-weight:700}
.win .body{padding:12px;flex:1;overflow:auto;font-size:14px;line-height:1.45}

/* ---------- MODAL ---------- */
.modal-back{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);z-index:9999}
.modal{width:92%;max-width:480px;background:#0d0d0d;padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.06)}
.modal h3{margin-bottom:10px}
.modal input, .modal textarea{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:#fff}

/* ---------- HELPERS ---------- */
.hint{opacity:.85;font-size:13px;color:#ddd}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#ff6b6b;color:#111;font-weight:700;font-size:12px}

/* ---------- RESPONSIVE ---------- */
@media(max-width:820px){
  .app-btn{width:88px;height:88px}
  .win{width:86%;left:7%}
  .windows-area{height:50vh}
}
</style>
</head>
<body>

<header>
  <div class="header-left">
    <div class="logo">EL</div>
    <div>
      <div class="header-title">ELISA Ultra</div>
      <div class="hint">Console de produtividade — multi-janelas</div>
    </div>
  </div>
  <div class="header-right">
    <div id="statusBadge" class="badge" style="display:none">Alta</div>
  </div>
</header>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-box">
    <h2>Entrar na ELISA Ultra</h2>
    <input id="username" placeholder="Usuário" />
    <input id="password" placeholder="Senha" type="password" />
    <button id="btnLogin">Entrar</button>
    <div style="margin-top:8px" class="hint">Use qualquer usuário/senha para demo.</div>
  </div>
</div>

<!-- DESKTOP -->
<div id="desktop" class="hidden" style="display:none;flex:1;flex-direction:column;align-items:center;justify-content:flex-start">
  <div class="desktop-inner">
    <div style="width:95%;max-width:1200px;display:flex;justify-content:space-between;align-items:center">
      <div class="hint">Bem-vindo — ELISA Ultra (single-file)</div>
      <div><button id="btnLogout" style="padding:6px 10px;border-radius:8px;border:none;background:#7b61ff;color:#fff;cursor:pointer">Sair</button></div>
    </div>

    <div class="menu" id="menu">
      <!-- buttons created by JS for icons + label, kept empty here for progressive enhancement -->
    </div>

    <div class="windows-area" id="windows-area"></div>
  </div>
</div>

<!-- MODAL -->
<div class="modal-back" id="modalBack">
  <div class="modal" id="modalBox" role="dialog" aria-modal="true">
    <h3 id="modalTitle">Modal</h3>
    <div id="modalBody"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
      <button id="modalCancel" style="padding:8px 12px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:#fff">Fechar</button>
      <button id="modalConfirm" style="padding:8px 12px;border-radius:8px;background:#7b61ff;color:#fff;border:none">OK</button>
    </div>
  </div>
</div>

<script>
/* ===========================
   ELISA ULTRA — SINGLE FILE
   =========================== */

/* ---------- UTIL ---------- */
const $ = s => document.querySelector(s);
const create = (tag, props={}) => { const e=document.createElement(tag); if(props.class) e.className = props.class; if(props.html) e.innerHTML = props.html; if(props.text) e.textContent = props.text; return e; };

/* ---------- STATE ---------- */
const windowsArea = $('#windows-area');
let openApps = {}; // appName -> element (window)
let maxOpenApps = 10;
let zBase = 100;
let winCount = 0;

/* ---------- APPS LIST (all apps internal) ---------- */
const APPS = [
  { id:'office', name:'Office' },
  { id:'chatgpt', name:'ChatGPT' },
  { id:'teams', name:'Teams' },
  { id:'whatsapp', name:'WhatsApp' },
  { id:'spotify', name:'Spotify' },
  { id:'youtube', name:'YouTube' },
  { id:'netflix', name:'Netflix' },
  { id:'prime', name:'Prime Video' },
  { id:'games', name:'Games' },
  { id:'files', name:'Arquivos' }
];

/* ---------- BOOT: build menu buttons ---------- */
function buildMenu(){
  const menu = $('#menu');
  menu.innerHTML = '';
  APPS.forEach(a=>{
    const btn = create('div',{class:'app-btn', html:`
      ${iconSVG(a.id)}
      <div style="font-size:13px">${a.name}</div>
    `});
    btn.dataset.app = a.id;
    btn.onclick = ()=> openAppSingle(a.id);
    menu.appendChild(btn);
  });
}
buildMenu();

/* ---------- ICONS (inline SVG by id) ---------- */
function iconSVG(id){
  const base = 'currentColor';
  switch(id){
    case 'office': return `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="14" height="18" rx="2" stroke="${base}" stroke-width="1.2"/><path d="M17 3v6h4" stroke="${base}" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
    case 'chatgpt': return `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="${base}" stroke-width="1.2"/></svg>`;
    case 'teams': return `<svg viewBox="0 0 24 24" fill="none"><circle cx="9" cy="8" r="2.5" stroke="${base}" stroke-width="1.2"/><path d="M9 10.5v4" stroke="${base}" stroke-width="1.1"/></svg>`;
    case 'whatsapp': return `<svg viewBox="0 0 24 24" fill="none"><path d="M21 12A9 9 0 1 1 12 3a1 1 0 0 0-.9.6L9 8l-2 1 2 1 1 3 2 1" stroke="${base}" stroke-width="1.2"/></svg>`;
    case 'spotify': return `<svg viewBox="0 0 24 24" fill="none"><path d="M3 9a13 13 0 0 1 18 0" stroke="${base}" stroke-width="1.2"/></svg>`;
    case 'youtube': return `<svg viewBox="0 0 24 24" fill="none"><rect x="3" y="6" width="18" height="12" rx="2" stroke="${base}" stroke-width="1.2"/><path d="M10 9l6 3-6 3V9z" stroke="${base}" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
    case 'netflix': return `<svg viewBox="0 0 24 24" fill="none"><path d="M6 4v16l4-1V5z" stroke="${base}" stroke-width="1.2"/></svg>`;
    case 'prime': return `<svg viewBox="0 0 24 24" fill="none"><path d="M3 12h18" stroke="${base}" stroke-width="1.2"/></svg>`;
    case 'games': return `<svg viewBox="0 0 24 24" fill="none"><path d="M6 10h4M10 6v8" stroke="${base}" stroke-width="1.2"/></svg>`;
    case 'files': return `<svg viewBox="0 0 24 24" fill="none"><path d="M3 7v10a2 2 0 0 0 2 2h14" stroke="${base}" stroke-width="1.2"/></svg>`;
    default: return `<svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="${base}" stroke-width="1.2"/></svg>`;
  }
}

/* ---------- OPEN APP (single-file behavior) ---------- */
function openAppSingle(appId){
  // limit
  if(Object.values(openApps).filter(w=>w).length >= maxOpenApps){
    alert('Sistema com muitas janelas abertas. Feche algumas primeiro.');
    return;
  }
  if(openApps[appId]) {
    // bring to front
    openApps[appId].style.zIndex = ++zBase;
    return;
  }

  // create window
  winCount++;
  const win = create('div',{class:'win'});
  win.style.top = (20 + 20*winCount) + 'px';
  win.style.left = (20 + 20*winCount) + 'px';
  win.style.zIndex = ++zBase;

  // header
  const head = create('div',{class:'head'});
  const title = create('div',{class:'title', text: appTitle(appId)});
  const controls = create('div',{class:'controls'});
  const btnMin = create('button',{class:'ctrl-btn', text: '—'});
  const btnClose = create('button',{class:'ctrl-btn', text: '✕'});
  controls.appendChild(btnMin); controls.appendChild(btnClose);
  head.appendChild(title); head.appendChild(controls);

  // body content based on app
  const body = create('div',{class:'body'});
  body.innerHTML = appContentHTML(appId);

  win.appendChild(head); win.appendChild(body);
  windowsArea.appendChild(win);
  openApps[appId] = win;

  // controls
  btnClose.onclick = ()=> closeAppSingle(appId);
  btnMin.onclick = ()=> {
    if(body.style.display === 'none'){ body.style.display = 'block'; win.style.height = 'auto'; }
    else { body.style.display = 'none'; win.style.height = '44px'; }
  };

  // draggable
  makeDraggable(win, head);

  // focus
  win.addEventListener('mousedown', ()=> win.style.zIndex = ++zBase );
}

/* ---------- CLOSE APP ---------- */
function closeAppSingle(appId){
  if(!openApps[appId]) return;
  try { windowsArea.removeChild(openApps[appId]); } catch(e){}
  openApps[appId] = null;
}

/* ---------- DRAGGABLE ---------- */
function makeDraggable(el, header){
  header.style.touchAction = 'none';
  header.onpointerdown = function(e){
    e.preventDefault();
    el.style.zIndex = ++zBase;
    const startX = e.clientX, startY = e.clientY;
    const rect = el.getBoundingClientRect();
    const offsetX = startX - rect.left, offsetY = startY - rect.top;

    function move(ev){
      el.style.left = (ev.clientX - offsetX) + 'px';
      el.style.top  = (ev.clientY - offsetY) + 'px';
    }
    function up(){
      window.removeEventListener('pointermove', move);
      window.removeEventListener('pointerup', up);
    }
    window.addEventListener('pointermove', move);
    window.addEventListener('pointerup', up);
  };
}

/* ---------- APP TITLES & CONTENT ---------- */
function appTitle(id){
  const a = APPS.find(x=>x.id===id);
  return a ? a.name : id;
}

function appContentHTML(id){
  // Each app has internal (demo) UI — expand as needed
  switch(id){
    case 'office':
      return `
        <strong>Editor de Texto</strong>
        <p class="hint">Editor simples — digite e use o botão "Salvar" para exportar texto (demo).</p>
        <textarea id="officeArea" style="width:100%;height:160px;border-radius:8px;padding:8px;margin-top:8px;background:#0b0b0b;color:#fff;border:1px solid rgba(255,255,255,0.04)"></textarea>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
          <button style="padding:8px 10px;border-radius:8px;border:none;background:#7b61ff;color:#fff" onclick="downloadText()">Salvar</button>
        </div>
      `;
    case 'chatgpt':
      return chatGPTUI();
    case 'teams':
      return `
        <strong>Teams (demo)</strong>
        <p class="hint">Sala de reuniões / colaboração (mock).</p>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input placeholder="Nome da sala" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:#fff"/>
          <button style="padding:8px 10px;border-radius:8px;border:none;background:#1db954;color:#fff">Criar</button>
        </div>
      `;
    case 'whatsapp':
      return whatsappUI();
    case 'spotify':
      return spotifyUI();
    case 'youtube':
      return `<strong>YouTube (demo)</strong><p class="hint">Player de vídeo embed (demo).</p><div style="margin-top:8px"><div style="background:#000;height:180px;border-radius:8px;display:flex;align-items:center;justify-content:center">Vídeo Simulado</div></div>`;
    case 'netflix':
      return `<strong>Netflix (demo)</strong><p class="hint">Reprodutor de vídeo (demo).</p><div style="margin-top:8px"><div style="background:#000;height:180px;border-radius:8px;display:flex;align-items:center;justify-content:center">Filme Simulado</div></div>`;
    case 'prime':
      return `<strong>Prime Video (demo)</strong><p class="hint">Reprodutor (demo).</p><div style="margin-top:8px"><div style="background:#000;height:180px;border-radius:8px;display:flex;align-items:center;justify-content:center">Conteúdo Simulado</div></div>`;
    case 'games':
      return gamesUI();
    case 'files':
      return filesUI();
    default:
      return `<div>App ${id} — demo.</div>`;
  }
}

/* ---------- APP INTERNAL UIs ---------- */

function chatGPTUI(){
  return `
    <strong>ChatGPT (local)</strong>
    <p class="hint">Aqui você pode digitar mensagens. Se enviar uma mensagem que começe com "abra" ou "abrir", eu tento executar comandos na ELISA.</p>
    <div id="chatArea" style="height:140px;overflow:auto;border-radius:8px;padding:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);margin-top:8px"></div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <input id="chatInput" placeholder="Digite um comando ou mensagem..." style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:#fff">
      <button style="padding:8px 10px;border-radius:8px;background:#7b61ff;color:#fff" onclick="sendChat()">Enviar</button>
    </div>
  `;
}

function whatsappUI(){
  return `
    <strong>WhatsApp (demo)</strong>
    <p class="hint">Lista de conversas e chat simples.</p>
    <div style="display:flex;gap:12px;margin-top:8px">
      <div style="width:34%;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px">
        <div style="font-weight:700;margin-bottom:8px">Conversas</div>
        <div style="opacity:.9">João</div>
        <div style="opacity:.8;margin-top:6px">Maria</div>
      </div>
      <div style="flex:1;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px">
        <div style="height:120px;overflow:auto" id="waChatArea"><div style="opacity:.9">João: Oi</div></div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="waInput" placeholder="Mensagem..." style="flex:1;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:#fff">
          <button style="padding:8px 10px;border-radius:8px;background:#25D366;color:#111" onclick="sendWA()">Enviar</button>
        </div>
      </div>
    </div>
  `;
}

function spotifyUI(){
  return `
    <strong>Spotify (demo)</strong>
    <p class="hint">Player simples — play/pause (simulado).</p>
    <div style="display:flex;align-items:center;gap:12px;margin-top:8px">
      <div style="width:84px;height:84px;background:linear-gradient(135deg,#1db954,#7bffb9);border-radius:8px;display:flex;align-items:center;justify-content:center;color:#111;font-weight:700">SP</div>
      <div style="flex:1">
        <div style="font-weight:700">Música Demo</div>
        <div class="hint">Artista — Álbum</div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button onclick="alert('Play (demo)')" style="padding:8px 10px;border-radius:8px;background:#1db954;border:none;color:#000">Play</button>
          <button onclick="alert('Pause (demo)')" style="padding:8px 10px;border-radius:8px;background:#fff;border:none;color:#000">Pause</button>
        </div>
      </div>
    </div>
  `;
}

function gamesUI(){
  return `
    <strong>Games</strong>
    <p class="hint">Lista de jogos disponíveis (demo).</p>
    <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px">
      <button style="padding:8px 10px;border-radius:8px;background:#111;border:1px solid rgba(255,255,255,0.04);" onclick="alert('Abrir jogo — demo')">Jogo 1</button>
      <button style="padding:8px 10px;border-radius:8px;background:#111;border:1px solid rgba(255,255,255,0.04);" onclick="alert('Abrir jogo — demo')">Jogo 2</button>
    </div>
  `;
}

function filesUI(){
  return `
    <strong>Gerenciador de Arquivos</strong>
    <p class="hint">Explorar/baixar arquivos (demo).</p>
    <div style="display:flex;gap:12px;margin-top:8px">
      <div style="width:30%;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px">
        <div style="font-weight:700;margin-bottom:8px">Pastas</div>
        <div style="opacity:.9">Documentos</div>
        <div style="opacity:.8;margin-top:6px">Downloads</div>
      </div>
      <div style="flex:1;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700">Documentos</div>
          <button style="padding:6px 8px;border-radius:8px;background:#7b61ff;color:#fff" onclick="alert('Upload (demo)')">Upload</button>
        </div>
        <div style="margin-top:8px">
          <div style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:6px">arquivo1.txt <button style="float:right" onclick="downloadSample()">Download</button></div>
        </div>
      </div>
    </div>
  `;
}

/* ---------- SENDERS / INTERACTIONS ---------- */
function sendChat(){
  const input = document.getElementById('chatInput');
  if(!input) return;
  const txt = input.value.trim();
  if(!txt) return;
  const area = document.getElementById('chatArea');
  if(area) area.innerHTML += `<div style="opacity:.95;margin-bottom:6px"><strong>Você:</strong> ${escapeHtml(txt)}</div>`;
  input.value = '';
  // se comando -> executar
  executarComandoElisa(txt);
  // resposta simulada
  setTimeout(()=>{ if(area) area.innerHTML += `<div style="opacity:.85;margin-bottom:6px"><strong>ChatGPT:</strong> (resposta demo) — recebi: ${escapeHtml(txt)}</div>`; area.scrollTop = area.scrollHeight; },500);
}

function sendWA(){
  const input = document.getElementById('waInput');
  if(!input) return;
  const txt = input.value.trim();
  if(!txt) return;
  const area = document.getElementById('waChatArea');
  area.innerHTML += `<div style="opacity:.85;margin-top:6px"><strong>Você:</strong> ${escapeHtml(txt)}</div>`;
  input.value = '';
}

/* ---------- DOWNLOAD / UTILS ---------- */
function downloadText(){
  const txt = document.getElementById('officeArea')?.value || '';
  const blob = new Blob([txt], {type:'text/plain;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'documento.txt';
  a.click();
  URL.revokeObjectURL(a.href);
}

function downloadSample(){
  const data = 'Conteúdo de exemplo do arquivo.';
  const blob = new Blob([data], {type:'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'arquivo1.txt';
  a.click();
  URL.revokeObjectURL(a.href);
}

function escapeHtml(str){ return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* ---------- EXECUTAR COMANDO (integração ChatGPT) ---------- */
function executarComandoElisa(comando){
  if(!comando) return;
  comando = comando.toLowerCase();
  // abrir apps
  if(comando.includes('abrir office')||comando.includes('abrir documento')||comando.includes('criar documento')) openAppSingle('office');
  else if(comando.includes('abrir teams')) openAppSingle('teams');
  else if(comando.includes('abrir spotify')||comando.includes('tocar música')) openAppSingle('spotify');
  else if(comando.includes('abrir youtube')) openAppSingle('youtube');
  else if(comando.includes('abrir whatsapp')) openAppSingle('whatsapp');
  else if(comando.includes('abrir netflix')) openAppSingle('netflix');
  else if(comando.includes('abrir prime')) openAppSingle('prime');
  else if(comando.includes('abrir jogos')||comando.includes('abrir games')) openAppSingle('games');
  else if(comando.includes('abrir arquivos')||comando.includes('abrir pendrive')) openAppSingle('files');
  else {
    // comando não reconhecido — deixar como mensagem no chat se existir
    const area = document.getElementById('chatArea');
    if(area) area.innerHTML += `<div style="opacity:.8;margin-top:6px"><em>Comando não reconhecido: ${escapeHtml(comando)}</em></div>`;
  }
}

/* ---------- LOGIN / PRELOAD ---------- */
function login(){
  const u = $('#username').value.trim();
  const p = $('#password').value.trim();
  if(!u || !p){ alert('Digite usuário e senha.'); return; }
  $('#login-screen').style.display = 'none';
  $('#desktop').style.display = 'flex';
  preloadApps();
}

function preloadApps(){
  APPS.forEach(a => openApps[a.id] = null);
}

/* ---------- MONITOR SIMULADO ---------- */
setInterval(()=>{
  const used = Object.values(openApps).filter(x=>x).length;
  const badge = $('#statusBadge');
  if(used >= Math.max(8, maxOpenApps-2)){ badge.style.display='inline-block'; badge.textContent='Alta'; }
  else if(used>0){ badge.style.display='inline-block'; badge.textContent='OK'; }
  else badge.style.display='none';
},1500);

/* ---------- AUTH / UI HOOKS ---------- */
$('#btnLogin').addEventListener('click', login);
$('#btnLogout').addEventListener('click', ()=> { location.reload(); });

/* ---------- PRE-OPEN: welcome window ---------- */
function openWelcome(){
  setTimeout(()=> openWindow('Boas-vindas', '<strong>Bem-vindo à ELISA Ultra</strong><p class="hint">Abra apps pelo menu.</p>'), 600);
}

/* ---------- GENERIC OPEN WINDOW (non-app) ---------- */
function openWindow(title, html){
  // similar to openAppSingle but no mapping to openApps
  winCount++;
  const win = create('div',{class:'win'});
  win.style.top = (30 + 18*winCount) + 'px';
  win.style.left = (30 + 18*winCount) + 'px';
  win.style.zIndex = ++zBase;
  const head = create('div',{class:'head'});
  const t = create('div',{class:'title', text: title});
  const ctrls = create('div',{class:'controls'});
  const btnMin = create('button',{class:'ctrl-btn', text:'—'});
  const btnClose = create('button',{class:'ctrl-btn', text:'✕'});
  ctrls.appendChild(btnMin); ctrls.appendChild(btnClose);
  head.appendChild(t); head.appendChild(ctrls);
  const body = create('div',{class:'body', html: html});
  win.appendChild(head); win.appendChild(body);
  windowsArea.appendChild(win);
  btnClose.onclick = ()=> win.remove();
  btnMin.onclick = ()=> { if(body.style.display==='none'){ body.style.display='block'; win.style.height='auto'; } else { body.style.display='none'; win.style.height='44px'; } };
  makeDraggable(win, head);
}

/* ---------- INITIAL FLOW ---------- */
openWelcome();

/* ---------- UTIL: openWindowApp wrapper for direct open (exposed) ---------- */
function openWindowApp(name){ openWindow(name, `<div class="hint">Janela: ${escapeHtml(name)} (demo)</div>`); }

/* ---------- compatibility: expose for console debug ---------- */
window.openAppSingle = openAppSingle;
window.executarComandoElisa = executarComandoElisa;

/* ---------- disable accidental text selection while dragging ---------- */
document.addEventListener('dragstart', e => e.preventDefault());

</script>
</body>
</html>
